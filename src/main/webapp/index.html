<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="robots" content="noindex,nofollow" />
 
	<title>書庫管理システム ＜蒼のインプルス＞</title>
	<link rel="stylesheet" type="text/css" href="css/main.css" />
	<link rel="stylesheet" type="text/css" href="css/bookShelf.css" />

	<script language="JavaScript">
		
		var myEditForm;

		
		/**
		 * HTTPリクエスト
		 */
		var httpRequest;

		function callJson(url){
			if(window.XMLHttpRequest){
				httpRequest = new XMLHttpRequest();
			}
			else if ( window.ActiveXObject ){
				httpRequest = new ActiveXObject("Microsoft.XMLHTTP");
			}
			httpRequest.open("GET", url, true);
			httpRequest.onreadystatechange = callback;
			httpRequest.send(null);
		}

		function callback(){
			if(httpRequest.readyState==4){
				if(httpRequest.status==200){
					populateJSON(httpRequest.responseText);
				}
			}
		}

	</script>
</head>
<body >
<h1 >書庫管理システム ＜蒼のインプルス＞</h1>
<div style="text-align: right;">
 ようこそ○○さん or 
 ログイン
</div>
<div>
<span style="background-color: #fffacd">本棚</span>
<span style="background-color: #bdb76b"><a href="login.action">蔵書情報ログイン画面 </a>(作成中)<br /></span>
</div>
<div style="background-color: #deb887">

<div id="pageStatus"></div>
<table border="2" id="shelf"></table>
<div id="pageStatusBottom"></div>

</div>
	<script language="JavaScript">
		var pageNo ; 
		function populateJSON(result){
			// jsonの結果を格納します
			var jsonResultObject = eval('('+result+')');
			updateStatus(jsonResultObject);
			var tblShelf = document.getElementById("shelf");
			tblShelf.innerHTML='';
			var nowRow = tblShelf.rows.length;
			if(nowRow==0){
				tblShelf.insertRow(nowRow++);
			}

			for(var i = 0 ; i < jsonResultObject.results.length ; i ++){
				var book = jsonResultObject.results[i];
				var currentRow = tblShelf.rows.item(nowRow-1);
				if(currentRow.cells.length>=4){
					tblShelf.insertRow(nowRow++);
					currentRow = tblShelf.rows.item(nowRow-1);
				}
				var newCell = currentRow.insertCell(0);
				newCell.innerHTML = createBookCellHTML(book);
			}
			// 余りの空棚を埋める
			if(jsonResultObject.results.length%4!=0){
				for(var i = 0 ; i < (4-jsonResultObject.results.length%4) ; i ++){
					var newCell = currentRow.insertCell(0);
					newCell.innerHTML = "";
				}
			}
		}
		function createBookCellHTML(book){
			var html="";
			html += '<div class="book">';
			html += '<div class="cover">';
			if(book.imageUrl!=null)
				html += '<img style="width:55px;" src="'+book.imageUrl+'"　/>';
			html += '</div>';
			html += '<div class="info">';
			html += '<br>';
			html += '<div>';
			html += '<a href ="detail.action?isbn='+book.barcode+'" >';
			html += book.title
			html += '</a>';
			html += '</div>';
			html += '<div>著：'+book.author+'</div>';
			html += '<div class="isbn">ISBN：'+book.barcode+'</div>';
			html += '</div>';
			html += '</div>';

			return html;
		}
		function updateStatus(jsonResultObject){
			// ページングを処理する
			var html = '';
			pageNo = jsonResultObject.pageNo;
			var totalPage = Math.ceil(jsonResultObject.totalCount/jsonResultObject.pageView);
			var isPrePage = !(jsonResultObject.pageNo==1);
			var isNextPage = !((jsonResultObject.pageNo+1)>totalPage);
			if(isPrePage)
				html+=' <a href="#" onclick="onClickPrePage();return false;">前有り</a> ';
			else
				html+=' 前なし ';

			html+='全'+jsonResultObject.totalCount+'件 '; 
			html+=pageNo+'ページ'; 
			html+=' / '+totalPage+'ページ'; 
			html+='( @ '+jsonResultObject.pageView+'件 )'; 
			if(isNextPage)
				html+=' <a href="#" onclick="onClickNextPage();return false;">次有り</a> ';
			else
				html+=' 次なし ';
			
			document.getElementById("pageStatus").innerHTML = html;
			document.getElementById("pageStatusBottom").innerHTML = html;
		}
		
		function onClickPrePage(){
			pageNo--;
			callJson("book.action?pageNo="+pageNo);
		}
		function onClickNextPage(){
			pageNo++;
			callJson("book.action?pageNo="+pageNo);
		}
		callJson("book.action");

		
	</script>

</body>
</html>
